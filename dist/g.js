function Ball(t,e){this.id=t,this.data=e,this.x=0,this.y=0,this.r=10,this.vx=0,this.vy=0,this.c=function(){let t="#";for(let e=0;e<6;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}(),this.isAlive=!0,this.isYoung=!0,this.bumped=[];let i=null,s=null;this.done=!1;let r=0;const n=2*Math.PI,h={hor:!1,vert:!1},o=[.45,.35,.3],l=()=>{return`bold ${Math.round(this.r*o[e.complexity])}px sans-serif`};this.render=(()=>{this.isAlive&&(i.fillStyle=this.c,i.beginPath(),i.arc(this.x,this.y,this.r,0,n),i.fill(),i.fillStyle="#eee",i.beginPath(),i.arc(this.x,this.y,.9*this.r,0,n),i.fill(),i.fillStyle="#333",i.font=l(),i.fillText(e.expression,this.x,this.y))}),this.bump=((t,e,i)=>{this.bumped.includes(t)||(this.c="red",this.vx=1.1*e,this.vy=1.1*i,this.bumped.push(t),this.done=!0)}),this.setData=(t=>{i=t.ctx,s=t.bounds,this.x=t.x,this.y=t.y,this.vx=t.vx,this.vy=t.vy}),this.update=(()=>{let t=-4;this.done||(t=++r%5==0?1:0),this.r+=t,this.r=this.r>120?120:this.r,this.r<=0?this.isAlive=!1:this.r>30&&(this.isYoung=!1),this.x+this.r>s.w||this.x-this.r<0?h.vert||(this.vx*=-1,h.vert=!0):h.vert=!1,this.y+this.r>s.h||this.y-this.r<0?h.hor||(this.vy*=-1,h.hor=!0):h.hor=!1,this.x+=this.vx,this.y+=this.vy}),this.intersects=(t=>{if(this.done)return!1;return function(t,e){return Math.hypot(t.x-e.x,t.y-e.y)}(this,t)<this.r+t.r})}function Game(t,e){let i,s,r,n=0,h=12,o=Date.now(),l=!0,a=7;function c(c){const d=Date.now()-o,u=12-Math.round(d/1e3);c<a&&function(){const i=function(){let t="";for(let e=0;e<10;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}();l=!l;const s=t.getExpression(l),n=new e(i,s);r.spawn(n)}(),u!==h&&(h=u,s.setText(h)),d>12e3&&(i.setText(`TIME OUT! SCORE: ${n}`),r.stop())}this.onCorrect=(()=>{o=Date.now(),h=12,n++,i.setText(`SCORE: ${n}`),20!==n&&30!==n||t.levelUp(),a=Math.floor(n/15)+7}),this.onFail=(()=>{r.stop(),i.setText(`WRONG! SCORE: ${n}`)}),this.reset=(()=>{n=0,h=12,o=Date.now(),i.setText("SCORE: 0")}),this.start=(t=>{(r=t).addCallback(c)}),this.setTextfields=((t,e)=>{s=e,(i=t).setText("SCORE: 0"),s.setText(h)})}function Generator(){const t={add:function(t,e){return t+e},substract:function(t,e){return t-e},addSign:"+",substractSign:"-"},e=[[1,1],[2,1],[2,2]];let i=0,s=[e[i]];function r(t=1){return Array.from({length:t},(t,e)=>e?n():n(e)).join("")}function n(t){let e=Math.floor(10*Math.random());for(;e===t;)e=Math.floor(10*Math.random());return e.toString()}this.getExpression=(e=>{return function(e,s){const n=r(e[0]),h=r(e[1]),o=Math.random()>.5?"add":"substract",l=t[`${o}Sign`],a=t[o](+n,+h),c=s?a:function(t){let e;const i=Math.round(Math.random());e=t<10?i?t+1:t-1:i?Math.ceil(1.04*t):Math.floor(.98*t);return e}(a);return{complexity:i,isCorrect:s,actual:a,expression:`${n} ${l} ${h} = ${c}`}}(function(t){return t[Math.floor(Math.random()*t.length)]}(s),e)}),this.levelUp=(()=>{e[++i]&&s.push(e[i])}),this.reset=(()=>{s=[e[i=0]]})}const generator=new Generator,game=new Game(generator,Ball),world=new World,player=new Player(game,world.centerX,world.centerY),scoreText=new Textfield({x:world.centerX,y:world.height-30,color:"#fff",fontSize:36}),timerText=new Textfield({x:world.width-30,y:world.height-30,color:"#fff",fontSize:36,text:"12"}),toolbar=new Rect({x:0,y:world.height-60,w:world.width,h:60,color:"rgba(0,0,0,0.5)"});function init(){generator.reset(),player.reset(),game.reset(),world.reset(),world.spawn(player),world.spawn(toolbar),world.spawn(scoreText),world.spawn(timerText)}function Player(t,e,i){this.x=e,this.y=i,this.r=50,this.id="player",this.c1="red",this.c2="green",this.isAlive=!0;let s=!1;this.data={isCorrect:null};let r=null,n=null;const h=2*Math.PI;this.render=(()=>{s&&(r.fillStyle=this.c1,r.beginPath(),r.arc(this.x,this.y,this.r,0,h),r.fill(),r.fillStyle=this.c2,r.beginPath(),r.arc(this.x,this.y,.9*this.r,0,h),r.fill())}),this.reset=(()=>{this.c1="red",this.c2="green",this.isAlive=!0}),this.bump=((e,i,s,r)=>{r?(this.c1="green",t.onCorrect(),setTimeout(()=>{this.c1="red"},500)):(this.c2="red",t.onFail())}),this.setData=(e=>{r=e.ctx,n=e.bounds,r.canvas.addEventListener("mousemove",e=>{if(t.over)return;s=!0;const{x:i,y:n}=function(t,e){const i=t.getBoundingClientRect();return{x:e.pageX-i.left,y:e.pageY-i.top}}(r.canvas,e);this.x=i,this.y=n})}),this.update=(()=>{}),this.intersects=(t=>{if(!s)return!1;return function(t,e){return Math.hypot(t.x-e.x,t.y-e.y)}(this,t)<this.r+t.r})}function Rect({x:t,y:e,w:i,h:s,color:r}){this.isStatic=!0;let n=null;this.render=(()=>{n.fillStyle=r,n.fillRect(t,e,i,s)}),this.setData=(t=>{n=t.ctx})}function Textfield({x:t,y:e,color:i,fontSize:s,text:r=""}){this.text=r,this.prefix="",this.id="TF",this.isStatic=!0;const n=`${s}px sans-serif`;let h=null;this.setText=(t=>{this.text=t}),this.setPrefix=(t=>{this.prefix=t}),this.render=(()=>{h.fillStyle=i,h.font=n,h.fillText(this.prefix+this.text,t,e)}),this.setData=(t=>{h=t.ctx})}function World(){const t=document.querySelector("canvas"),e=t.getContext("2d"),i=.3;let s=[],r=[],n=!0;const h={w:window.innerWidth-8,h:window.innerHeight-8},o=[];let l=performance.now(),a=0;function c(h){if(a>3)return;const u=h-l;!function(){for(let t=s.length-1;t>=0;t--){let e=s[t];e.isAlive?(s.forEach(d),e.update()):(s.splice(t,1),e=null)}}(),u>i&&(l=h,e.clearRect(0,0,t.width,t.height),s.forEach(t=>t.render()),r.forEach(t=>t.render()),function(){const t=s.length;o.forEach(e=>e(t))}()),n&&a++,requestAnimationFrame(c)}function d(t,e){t.done||t.isYoung||s.forEach((i,s)=>{if(s<=e||i.done||i.isYoung)return;if(t.intersects(i)){const e=t.vx,s=t.vy;t.bump(i.id,i.vx,i.vy,i.data.isCorrect),i.bump(t.id,e,s,t.data.isCorrect)}})}function u(t,e){return Math.floor(Math.random()*(e-t+1)+t)}t.width=h.w,t.height=h.h,e.textAlign="center",e.textBaseline="middle",this.centerX=h.w/2,this.centerY=h.h/2,this.width=h.w,this.height=h.h,this.add=(t=>{t.isStatic?r.push(t):s.push(t)}),this.stop=(()=>{n=!0}),this.reset=(()=>{n=!1,s=[],r=[],l=performance.now(),a=0,c(l)}),this.addCallback=(t=>{o.push(t)}),this.spawn=(t=>{const i=function(){let t,e,i,s;switch(u(0,3)){case 0:t=u(0,h.w),e=0,i=u(-4,4),s=u(-4,-1);break;case 1:t=h.w,e=u(0,h.h),i=u(1,4),s=u(-4,4);break;case 2:t=u(0,h.w),e=h.h,i=u(-4,4),s=u(1,4);break;case 3:t=0,e=u(0,h.h),i=u(-4,-1),s=u(-4,4)}return{x:t,y:e,vy:s,vx:i}}();i.ctx=e,i.bounds=h,t.setData(i),this.add(t)})}window.onkeypress=(t=>{(game.over||32===t.keyCode)&&init()}),game.setTextfields(scoreText,timerText),game.start(world),init();
//# sourceMappingURL=g.js.map
