function Ball(t,e){this.id=t,this.data=e,this.x=0,this.y=0,this.r=10,this.vx=0,this.vy=0,this.c=function(){let t="#";for(let e=0;e<6;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}(),this.isAlive=!0,this.bumped=[];let i=null,s=null;this.done=!1;let r=0;const n=2*Math.PI,h={hor:!1,vert:!1},o=()=>`bold ${Math.round(.3*this.r)}px sans-serif`;this.render=(()=>{this.isAlive&&(i.fillStyle=this.c,i.beginPath(),i.arc(this.x,this.y,this.r,0,n),i.fill(),i.fillStyle="#eee",i.beginPath(),i.arc(this.x,this.y,.9*this.r,0,n),i.fill(),i.fillStyle="#333",i.font=o(),i.fillText(e.expression,this.x,this.y))}),this.bump=((t,e,i)=>{this.bumped.includes(t)||(this.c="red",this.vx=1.1*e,this.vy=1.1*i,this.bumped.push(t),this.done=!0)}),this.setData=(t=>{i=t.ctx,s=t.bounds,this.x=t.x,this.y=t.y,this.vx=t.vx,this.vy=t.vy}),this.update=(()=>{let t=-4;this.done||(t=++r%5==0?1:0),this.r+=t,this.r=this.r>120?120:this.r,this.r<=0&&(this.isAlive=!1),this.x+this.r>s.w||this.x-this.r<0?h.vert||(this.vx*=-1,h.vert=!0):h.vert=!1,this.y+this.r>s.h||this.y-this.r<0?h.hor||(this.vy*=-1,h.hor=!0):h.hor=!1,this.x+=this.vx,this.y+=this.vy}),this.intersects=(t=>{if(this.done)return!1;return function(t,e){return Math.hypot(t.x-e.x,t.y-e.y)}(this,t)<this.r+t.r})}function BallManager(t,e,i){function s(s){s<7&&function(){const s=function(){let t="";for(let e=0;e<10;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}(),r=e.getExpression(Math.random()>.5),n=new i(s,r);t.spawn(n)}()}this.start=(()=>{t.addCallback(s)})}function Game(t){let e,i=0,s=0;this.over=!1,this.onCorrect=(()=>{i++,s=0,e.setText(`SCORE: ${i}`),20!==i&&30!==i||t.levelUp()}),this.onFail=(()=>{this.over=!0,e.setText(`WRONG! SCORE: ${i}`)}),this.reset=(()=>{i=0,s=0,e.setText("SCORE: 0"),this.over=!1}),this.setScoreText=(t=>{(e=t).setText("SCORE: 0")}),this.tick=(()=>{700===++s?e.setText(`TIME OUT! SCORE: ${i}`):s>700&&(this.over=!0)})}function Generator(){const t={add:function(t,e){return t+e},substract:function(t,e){return t-e},addSign:"+",substractSign:"-"};let e=0;const i=[[1,1],[2,1],[2,2]];function s(e,i){const s=r(e[0]),n=r(e[1]),h=Math.random()>.5?"add":"substract",o=t[`${h}Sign`],a=t[h](+s,+n);return{isCorrect:i,actual:a,expression:`${s} ${o} ${n} = ${i?a:function(t){let e;const i=Math.round(Math.random());e=t<10?i?t+1:t-1:i?Math.ceil(1.04*t):Math.floor(.98*t);return e}(a)}`}}function r(t=1){return Array.from({length:t},(t,e)=>e?n():n(e)).join("")}function n(t){let e=Math.floor(10*Math.random());for(;e===t;)e=Math.floor(10*Math.random());return e.toString()}this.getExpression=s.bind(null,i[e]),this.levelUp=(()=>{i[++e]&&(this.getExpression=s.bind(null,i[e]))})}const generator=new Generator,game=new Game(generator),world=new World(game),ballManager=new BallManager(world,generator,Ball),player=new Player(game,world.centerX,world.centerY),scoreText=new Textfield({x:world.centerX,y:world.height-30,color:"#fff",fontSize:36}),toolbar=new Rect({x:0,y:world.height-60,w:world.width,h:60,color:"rgba(0,0,0,0.5)"});function init(){player.reset(),game.reset(),world.reset(),world.spawn(player),world.spawn(toolbar),world.spawn(scoreText),ballManager.start()}function Player(t,e,i){this.x=e,this.y=i,this.r=50,this.id="player",this.c1="red",this.c2="green",this.isAlive=!0;let s=!1;this.data={isCorrect:null};let r=null,n=null;const h=2*Math.PI;this.render=(()=>{s&&(r.fillStyle=this.c1,r.beginPath(),r.arc(this.x,this.y,this.r,0,h),r.fill(),r.fillStyle=this.c2,r.beginPath(),r.arc(this.x,this.y,.9*this.r,0,h),r.fill())}),this.reset=(()=>{this.c1="red",this.c2="green",this.isAlive=!0}),this.bump=((e,i,s,r)=>{r?(this.c1="green",t.onCorrect(),setTimeout(()=>{this.c1="red"},500)):(this.c2="red",t.onFail())}),this.setData=(e=>{r=e.ctx,n=e.bounds,r.canvas.addEventListener("mousemove",e=>{if(t.over)return;s=!0;const{x:i,y:n}=function(t,e){const i=t.getBoundingClientRect();return{x:e.pageX-i.left,y:e.pageY-i.top}}(r.canvas,e);this.x=i,this.y=n})}),this.update=(()=>{}),this.intersects=(t=>{if(!s)return!1;return function(t,e){return Math.hypot(t.x-e.x,t.y-e.y)}(this,t)<this.r+t.r})}function Rect({x:t,y:e,w:i,h:s,color:r}){this.isStatic=!0;let n=null;this.render=(()=>{n.fillStyle=r,n.fillRect(t,e,i,s)}),this.setData=(t=>{n=t.ctx})}function Textfield({x:t,y:e,color:i,fontSize:s,text:r=""}){this.text=r,this.prefix="",this.id="TF",this.isStatic=!0;const n=`${s}px sans-serif`;let h=null;this.setText=(t=>{this.text=t}),this.setPrefix=(t=>{this.prefix=t}),this.render=(()=>{h.fillStyle=i,h.font=n,h.fillText(this.prefix+this.text,t,e)}),this.setData=(t=>{h=t.ctx})}function World(t){const e=document.querySelector("canvas"),i=e.getContext("2d"),s=.3;let r=[],n=[];const h={w:window.innerWidth-8,h:window.innerHeight-8},o=[];let a=performance.now();function l(h){if(t.over)return;const d=h-a;!function(){for(let t=r.length-1;t>=0;t--){let e=r[t];e.isAlive?(r.forEach(c),e.update()):(r.splice(t,1),e=null)}}(),d>s&&(a=h,i.clearRect(0,0,e.width,e.height),r.forEach(t=>t.render()),n.forEach(t=>t.render()),function(){const t=r.length;o.forEach(e=>e(t))}()),requestAnimationFrame(l)}function c(t,e){t.done||r.forEach((i,s)=>{if(s<=e||i.done)return;if(t.intersects(i)){const e=t.vx,s=t.vy;t.bump(i.id,i.vx,i.vy,i.data.isCorrect),i.bump(t.id,e,s,t.data.isCorrect)}})}function d(t,e){return Math.floor(Math.random()*(e-t+1)+t)}e.width=h.w,e.height=h.h,i.textAlign="center",i.textBaseline="middle",this.centerX=h.w/2,this.centerY=h.h/2,this.width=h.w,this.height=h.h,this.add=(t=>{t.isStatic?n.push(t):r.push(t)}),this.reset=(()=>{r=[],n=[],l(a=performance.now())}),this.addCallback=(t=>{o.push(t)}),this.spawn=(t=>{const e=function(){let t,e,i,s;switch(d(0,3)){case 0:t=d(0,h.w),e=0,i=d(-4,4),s=d(-4,-1);break;case 1:t=h.w,e=d(0,h.h),i=d(1,4),s=d(-4,4);break;case 2:t=d(0,h.w),e=h.h,i=d(-4,4),s=d(1,4);break;case 3:t=0,e=d(0,h.h),i=d(-4,-1),s=d(-4,4)}return{x:t,y:e,vy:s,vx:i}}();e.ctx=i,e.bounds=h,t.setData(e),this.add(t)}),this.addCallback(t.tick),l(a)}window.onkeypress=(t=>{(game.over||32===t.keyCode)&&init()}),game.setScoreText(scoreText),init();
//# sourceMappingURL=g.js.map
